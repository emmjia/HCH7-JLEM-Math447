---
title: 'Chapter 7(Eighth Edition): 7.1, 7.2, 7.4, 7.13, 7.24, 7.25'
author: "Jeremy Ling & Emmanuel Mejia"
date: "May 1, 2018"
output: pdf_document
---

##7.1

\textbf{Consider the experiment described in Problem 6.1.
Analyze this experiment assuming that each replicate represents
a block of a single production shift.}

```{r}
# defining coded
coded=function(x) #a function to code variable x
{
  ifelse(x=="+", 1, -1)
}

# creating data table
factorA = rep(c("-","+","-","+","-","+","-","+"), times = 3)
factorB = rep(c("-","-","+","+","-","-","+","+"), times = 3)
factorC = rep(c("-","-","-","-","+","+","+","+"), times = 3)
Rep = rep(c("I", "II", "III"), each = 8)
yield = c(22,32,35,55,44,40,60,39,31,43,34,47,45,37,50,41,25,29,50,46,38,36,54,47)

#dataframe
cutting.speed.long = data.frame(factorA, factorB, factorC, Rep, yield)

cutting.aov = aov(yield~Rep+factorA*factorB*factorC, cutting.speed.long)
cutting.aov.og = aov(yield~factorA*factorB*factorC, cutting.speed.long)
summary(cutting.aov); summary(cutting.aov.og)
```

We look at the analysis of variance we see that the block effect is insignificant because the p-value is small, but effect B, C, and AC are significant. We also make a comparison to the analysis of Variance without the blocking to see if there was a difference. In this case there is no difference at the coefficients of our effects.

##7.2

\textbf{Consider the experiment described in Problem 6.5.
Analyze this experiment assuming that each one of the four
replicates represents a block.}

```{r}
# creating data table
A <- rep(c("-","+","-","+"), times = 4)
B <- rep(c("-","-","+","+"), times = 4)
Rep <- rep(c("I","II","III","IV"), each = 4)
Vibes <- c(18.2, 27.2, 15.9, 41.0, 18.9, 24.0, 14.5, 43.9, 12.9, 22.4, 15.1, 36.3, 14.4, 22.5, 14.2, 39.9)
router.long <- data.frame(A, B, Rep, Vibes)

# defining coded
coded=function(x) #a function to code variable x
{
  ifelse(x=="+", 1, -1)
}

# coding A and B
for (j in 1:2)
  router.long[, j]=as.numeric(coded(router.long[, j]))

#######
router.long$Block=router.long$A * router.long$B
router.lm = lm(Vibes ~ Block + A * B, router.long)
router.lm.og = lm(Vibes ~ A * B, router.long)
summary(router.lm); summary(router.lm.og)
```

After we analyze our variance we see that all main effects are significant including the Blocking effect. We see that there is no difference between coefficients, F-statistic of the model, $R^2$, and adjusted $R^2$. Which means blocking the replicates gives us a good model. 

##7.4

\textbf{Consider the data from the first replicate of Problem
6.1. Suppose that these observations could not all be run using
the same bar stock. Set up a design to run these observations
in two blocks of four observations each with ABC confounded.
Analyze the data.}

```{r}
# creating data table
factorA = rep(c("-","+","-","+","-","+","-","+"), times = 3)
factorB = rep(c("-","-","+","+","-","-","+","+"), times = 3)
factorC = rep(c("-","-","-","-","+","+","+","+"), times = 3)
Rep = rep(c("I", "II", "III"), each = 8)
yield = c(22,32,35,55,44,40,60,39,31,43,34,47,45,37,50,41,25,29,50,46,38,36,54,47)

cutting.speed.long = data.frame(factorA, factorB, factorC, Rep, yield)

# defining coded
coded=function(x) #a function to code variable x
{
  ifelse(x=="+", 1, -1)
}
```


##7.13

\textbf{Using the data from the $2^4$ design in Problem 6.22,
construct and analyze a design in two blocks with ABCD confounded
with blocks.}

```{r}
Standard.Order = c(8,10,12,9,7,15,2,6,16,13,5,14,1,3,4,11)
Run.Order = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16)
A = Laser.Power = c(1,1,1,-1,-1,-1,1,1,1,-1,-1,1,-1,-1,1,-1)
B = Pulse.Freq = c(1,-1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,1)
C = Cell.Size = c(1,-1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1)
D = Writing.Speed = c(-1,1,1,1,-1,1,-1,-1,1,1,-1,1,-1,-1,-1,1)
UEC = c(0.8,0.81,0.79,0.6,0.65,0.55,0.98,0.67,0.69,0.56,0.63,0.65,0.75,0.72,0.98,0.63)
error = data.frame(Standard.Order,Run.Order,A,B,C,D,UEC)

#Blocking#
error$Block=error$A * error$B * error$C * error$D
#Linear Model#
error.lm = lm(UEC ~ Block + A*B*C*D, error)#blocking
error.lm.og = lm(UEC ~ A*B*C*D, error)#regular

summary(error.lm); summary(error.lm.og)
```

##7.24

\textbf{Suppose that in Problem 6.1 we had confounded ABC
in replicate I, AB in replicate II, and BC in replicate III.
Calculate the factor effect estimates. Construct the analysis of
variance table.}

```{r}
# creating data table
factorA = rep(c("-","+","-","+","-","+","-","+"), times = 3)
factorB = rep(c("-","-","+","+","-","-","+","+"), times = 3)
factorC = rep(c("-","-","-","-","+","+","+","+"), times = 3)
Rep = rep(c("I", "II", "III"), each = 8)
yield = c(22,32,35,55,44,40,60,39,31,43,34,47,45,37,50,41,25,29,50,46,38,36,54,47)

cutting.speed.long = data.frame(factorA, factorB, factorC, Rep, yield)

# defining coded
coded=function(x) #a function to code variable x
{
  ifelse(x=="+", 1, -1)
}

# subsetting Rep I
cutting.speed.long1 <- cutting.speed.long[cutting.speed.long$Rep == "I",]

A <- coded(cutting.speed.long1$factorA)
B <- coded(cutting.speed.long1$factorB)
C <- coded(cutting.speed.long1$factorC)

cutting.speed.long1$Block <- ifelse(A * B * C > 0, 1, 2)
cutting.speed.long1 <- cutting.speed.long1[order(cutting.speed.long1$Block),]

# subsetting Rep II
cutting.speed.long2 <- cutting.speed.long[cutting.speed.long$Rep == "II",]

A <- coded(cutting.speed.long2$factorA)
B <- coded(cutting.speed.long2$factorB)
C <- coded(cutting.speed.long2$factorC)

cutting.speed.long2$Block <- ifelse(A * B > 0, 1, 2)
cutting.speed.long2 <- cutting.speed.long2[order(cutting.speed.long2$Block),]

# subsetting Rep III
cutting.speed.long3 <- cutting.speed.long[cutting.speed.long$Rep == "III",]

A <- coded(cutting.speed.long3$factorA)
B <- coded(cutting.speed.long3$factorB)
C <- coded(cutting.speed.long3$factorC)

cutting.speed.long3$Block <- ifelse(B * C > 0, 1, 2)
cutting.speed.long3 <- cutting.speed.long3[order(cutting.speed.long3$Block),]

# creating new data table
p.confound <- rbind(cutting.speed.long1, cutting.speed.long2, cutting.speed.long3)
p.confound$Rep <- factor(p.confound$Rep)
p.confound$Blocks <- factor(paste(p.confound$Rep, p.confound$Block,
                                  sep = "-"))

# running regression
p.confound.aov <- aov(yield ~ Blocks + factorA * factorB * factorC, p.confound)
summary(p.confound.aov)

p.confound.lm <- aov(yield ~ Blocks + coded(factorA) * coded(factorB) * coded(factorC), p.confound)
summary(p.confound.lm)
```


##7.25

\textbf{Repeat the analysis of Problem 6.1 assuming that
ABC was confounded with blocks in each replicate.}

```{r}
# creating data table
factorA = rep(c("-","+","-","+","-","+","-","+"), times = 3)
factorB = rep(c("-","-","+","+","-","-","+","+"), times = 3)
factorC = rep(c("-","-","-","-","+","+","+","+"), times = 3)
Rep = rep(c("I", "II", "III"), each = 8)
yield = c(22,32,35,55,44,40,60,39,31,43,34,47,45,37,50,41,25,29,50,46,38,36,54,47)

cutting.speed.long = data.frame(factorA, factorB, factorC, Rep, yield)

# defining coded
coded=function(x) #a function to code variable x
{
  ifelse(x=="+", 1, -1)
}
```